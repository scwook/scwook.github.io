---
layout: post
title: "16x4 Character LCD Test"
show: true
language:
  - en
  - kr
categories: RaspberryPi
---
The LCD1604 is a character LCD which can print 2Line more than the [LCD1602]({{site.url}}/raspberrypi/2016/12/29/lcd1602-en.html). The LCD1604 print by using 8bit In/Out lines. So you have to connect 4 lines more than the LCD1602.

### Component

* Raspberry Pi 2 Model B
* [LCD1620](http://www.waveshare.com/lcd1604-blue.htm)
* Resistor 1~2kâ„¦

![LCD1604 Test Circuit]({{site.url}}/images/rpi_lcd1604_test.png)

### Edit Dev Lib

There is a problem with the Wiring Pi v2.29 when a character is printed on the LCD1604. To solve this problem, you have to modify that the lcdPosition offset value where is located in lcd.c file.

{% highlight c linenos %}
void lcdPosition (const int fd, int x, int y)
{
  static unsigned char rowOff [4] ;
  struct lcdDataStruct *lcd = lcds [fd] ;

  if ((x > lcd->cols) || (x < 0))
    return ;
  if ((y > lcd->rows) || (y < 0))
    return ;

  if (lcd->rows == 4 && lcd->cols == 16)
  {
    rowOff[0] = 0x00; rowOff[1] = 0x40; rowOff[2] = 0x10; rowOff[3] = 0x50;
  }
  else
  {
    rowOff[0] = 0x00; rowOff[1] = 0x40; rowOff[2] = 0x14; rowOff[3] = 0x54;
  }

   putCommand (lcd, x + (LCD_DGRAM | rowOff [y])) ;

  lcd->cx = x ;
  lcd->cy = y ;
}
{% endhighlight %}

Now rebuild the wiringPi

{% highlight shell %}
pi@raspberrypi ~/wiringPi $ ./build clean
pi@raspberrypi ~/wiringPi $ ./build 
{% endhighlight %}

### Source Code

filename: lcd1604Test.c

{% highlight c linenos %}
#include <stdio.h>
#include <wiringPi.h>
#include <lcd.h>

#define TRUE 1
#define FALSE 0

int main(void)
{
  if(wiringPiSetup() == -1)
  {
    printf("Unable to start wiringPi\n");
    return 1;
  }

  int fd;

  fd = lcdInit(4, 16, 8, 28, 29, 0,1,2,3,4,5,6,7);

  lcdHome(fd);
  lcdCursor(fd, TRUE);
  lcdCursorBlink(fd, FALSE);

  lcdPosition(fd, 0,0);
  lcdPrintf(fd, "Line1");

  lcdPosition(fd, 0,1);
  lcdPrintf(fd, "Line2");

  lcdPosition(fd, 0,2);
  lcdPrintf(fd, "Line3");

  lcdPosition(fd, 0,3);
  lcdPrintf(fd, "Line4");

  return 0;
}
{% endhighlight %}

Compile and run the program.

{% highlight console %}
pi@raspberrypi ~$ gcc -o lcd1604Test lcd1604Test.c -lwiringPi -lwiringPiDev
pi@raspberrypi ~$ sudo ./lcd1604Test
{% endhighlight %}
