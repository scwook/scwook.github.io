---
layout: post
title: "16x4 Character LCD Test"
language:
  - en
  - kr
categories: RaspberryPi
---
LCD1604는 [LCD1602]({{site.url}}/raspberrypi/2016/12/29/lcd1602-kr.html)보다 2Line 더 출력할 수 있는 Character LCD이다. LCD1604는 총 8bit의 In/Out Line을 통해 문자를 출력하므로 LCD1602보다 4개의 라인을 더 연결해야 한다.

### Component

* Raspberry Pi 2 Model B
* [LCD1620](http://www.waveshare.com/lcd1604-blue.htm)
* Resistor 1~2kΩ

![LCD1604 Test Circuit]({{site.url}}/images/rpi_lcd1604_test.png)

### Edit Dev Lib

Wiring Pi v2.29를 기준으로 LCD1604에 문자를 출력할 경우 3번째 라인부터 제대로 출력되지 않는 문제점이 있다. 해결 방법은 devLib에 있는 lcd.c 파일의 lcdPosition함수를 다음과 같이 수정하면 된다.

{% highlight c linenos %}
void lcdPosition (const int fd, int x, int y)
{
  static unsigned char rowOff [4] ;
  struct lcdDataStruct *lcd = lcds [fd] ;

  if ((x > lcd->cols) || (x < 0))
    return ;
  if ((y > lcd->rows) || (y < 0))
    return ;

  if (lcd->rows == 4 && lcd->cols == 16)
  {
    rowOff[0] = 0x00; rowOff[1] = 0x40; rowOff[2] = 0x10; rowOff[3] = 0x50;
  }
  else
  {
    rowOff[0] = 0x00; rowOff[1] = 0x40; rowOff[2] = 0x14; rowOff[3] = 0x54;
  }

   putCommand (lcd, x + (LCD_DGRAM | rowOff [y])) ;

  lcd->cx = x ;
  lcd->cy = y ;
}
{% endhighlight %}

수정을 완료했으면 wiringPi를 다시 빌드한다.

{% highlight shell %}
pi@raspberrypi ~/wiringPi $ ./build clean
pi@raspberrypi ~/wiringPi $ ./build 
{% endhighlight %}

### Source Code

filename: lcd1604Test.c

{% highlight c linenos %}
#include <stdio.h>
#include <wiringPi.h>
#include <lcd.h>

#define TRUE 1
#define FALSE 0

int main(void)
{
  if(wiringPiSetup() == -1)
  {
    printf("Unable to start wiringPi\n");
    return 1;
  }

  int fd;

  fd = lcdInit(4, 16, 8, 28, 29, 0,1,2,3,4,5,6,7);

  lcdHome(fd);
  lcdCursor(fd, TRUE);
  lcdCursorBlink(fd, FALSE);

  lcdPosition(fd, 0,0);
  lcdPrintf(fd, "Line1");

  lcdPosition(fd, 0,1);
  lcdPrintf(fd, "Line2");

  lcdPosition(fd, 0,2);
  lcdPrintf(fd, "Line3");

  lcdPosition(fd, 0,3);
  lcdPrintf(fd, "Line4");

  return 0;
}
{% endhighlight %}

컴파일 후 프로그램을 실행한다.

{% highlight console %}
pi@raspberrypi ~$ gcc -o lcd1604Test lcd1604Test.c -lwiringPi -lwiringPiDev
pi@raspberrypi ~$ sudo ./lcd1604Test
{% endhighlight %}
